<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IOT WATER POLLUTION SENSOR</title>
    <link rel="stylesheet" href="style.css"/>

</head>

<body>
    <h1>IOT Water Sensor Reading</h1>
    <div id="sample">
        <div class="measurement-box glass">
            <h2>Temperature</h2>
            <div id="temp">
                <div class="gauge-container">
                    <div class="gauge temp-gauge">
                        <div class="gauge-bg"></div>
                        <div class="gauge-fill"></div>
                        <div class="gauge-center">
                            <span class="gauge-label">0%</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="measurement-box glass">
            <h2>Humidity</h2>
            <div id="humidity">
                <div class="gauge-container">
                    <div class="gauge humid-gauge">
                        <div class="gauge-bg"></div>
                        <div class="gauge-fill"></div>
                        <div class="gauge-center">
                            <span class="gauge-label">0%</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="measurement-box glass water-card" id="water">
            <h2>Water Quality</h2>
            <div id="water">
                <div class="gauge-container">
                    <div class="gauge water-gauge">
                        <div class="gauge-bg"></div>
                        <div class="gauge-fill"></div>
                        <div class="gauge-center">
                            <span class="gauge-label">0%</span>
                        </div>
                    </div>
                </div>
                <div class="water-remark">
                    <span id="waterQualityRemark">Evaluating...</span>
                </div>
            </div>
        </div>
          
    </div>

    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>

    <script>
        // Initialize socket with the correct server URL and port
        const socket = io('http://localhost:3000', {
            transports: ['polling']
        });

        socket.on('connect', () => {
            console.log("✅ Connected to server via Socket.io with ID:", socket.id);
        });

        socket.on('connect_error', (error) => {
            console.error("❌ Connection error:", error.message);
        });

        socket.on('sensorData', function(data) {
            console.log("📊 Received data:", data);
            
            // Update basic readings
            document.getElementById('temp').innerText = data.temperature?.toFixed(1) || "--";
            document.getElementById('humidity').innerText = data.humidity?.toFixed(1) || "--";
            document.getElementById('quality').innerText = data.waterQuality?.toFixed(1) || "--";
            
            // Update turbidity readings
            document.getElementById('voltage').innerText = data.turbidityVoltage?.toFixed(2) || "--";
            document.getElementById('ntu').innerText = data.turbidityNTU?.toFixed(1) || "--";

            // Convert NTU to percentage clarity (example scale: 0 NTU = 100%, 100+ NTU = 0%)
            let clarityPercent = 100 - Math.min(data.turbidityNTU, 100); // clamp max NTU to 100 for display
            clarityPercent = Math.max(0, Math.min(100, clarityPercent.toFixed(0)));

            // Update gauge and label
            updateGauge('water', clarityPercent);

            // Update status label if you still want it separately
            const statusElement = document.getElementById('status');
            let status = data.status;
            if (!status) {
                if (data.turbidityNTU >= 0 && data.turbidityNTU <= 1) {
                    status = "Drinkable";
                } else if (data.turbidityNTU > 1 && data.turbidityNTU <= 5) {
                    status = "Clear";
                } else if (data.turbidityNTU > 5 && data.turbidityNTU <= 25) {
                    status = "Slightly Cloudy";
                } else if (data.turbidityNTU > 25 && data.turbidityNTU <= 50) {
                    status = "Cloudy";
                } else if (data.turbidityNTU > 50 && data.turbidityNTU <= 100) {
                    status = "Very Cloudy";
                } else if (data.turbidityNTU > 100) {
                    status = "Highly Polluted";
                } else {
                    status = "Sensor is not submerged in water";
                }
            }
            if (statusElement) statusElement.innerText = status;
        });

        // REMOVE this part if using real-time Socket data
        setInterval(() => {
            updateGauge('temp', Math.floor(Math.random() * 101));
            updateGauge('humidity', Math.floor(Math.random() * 101));
        }, 2000);


      </script>


      
      
    
</body>
</html>
